<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base :: layout(~{::title}, ~{::content}, ~{::js_assets})}">
<head>
    <title>Paramètres système - GESCOM</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #0dcaf0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-radius: 8px;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        body {
            background-color: #f5f7fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .main-content {
            padding: 2rem;
        }

        /* Header Section */
        .page-header {
            background: linear-gradient(135deg, var(--primary-color), #4285f4);
            color: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }

        .page-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 600;
        }

        .page-header p {
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Stats Cards */
        .stats-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary-color);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .stats-card .icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .stats-card .number {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
        }

        .stats-card .label {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin: 0;
        }

        /* Search and Filters */
        .search-filters {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .search-filters .form-control, .search-filters .form-select {
            border-radius: var(--border-radius);
            border: 1px solid #e0e6ed;
            padding: 0.75rem 1rem;
        }

        .search-filters .btn {
            border-radius: var(--border-radius);
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }

        /* Settings Cards */
        .settings-section {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .settings-section-header {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
        }

        .settings-section-header h4 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--dark-color);
            font-weight: 600;
        }

        .settings-section-header .icon {
            color: var(--primary-color);
            font-size: 1.25rem;
        }

        .settings-section-body {
            padding: 0;
        }

        .setting-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #f8f9fa;
            transition: background-color 0.2s;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-item:hover {
            background-color: #f8f9fa;
        }

        .setting-info {
            flex: 1;
        }

        .setting-key {
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 0.25rem;
        }

        .setting-description {
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin: 0;
        }

        .setting-value {
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 200px;
        }

        .setting-display-value {
            background: #f8f9fa;
            padding: 0.5rem 0.75rem;
            border-radius: var(--border-radius);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .setting-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-setting {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-edit {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-edit:hover {
            background-color: #e0a800;
            transform: translateY(-1px);
        }

        .btn-delete {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-delete:hover {
            background-color: #bb2d3b;
            transform: translateY(-1px);
        }

        .btn-duplicate {
            background-color: var(--info-color);
            color: white;
        }

        .btn-duplicate:hover {
            background-color: #0bb4d6;
            transform: translateY(-1px);
        }

        /* System Setting Badge */
        .system-badge {
            background-color: var(--info-color);
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            margin-left: 0.5rem;
        }

        /* Pagination */
        .pagination {
            justify-content: center;
        }

        .page-link {
            border-radius: var(--border-radius);
            margin: 0 0.125rem;
            border: 1px solid #dee2e6;
            color: var(--primary-color);
        }

        .page-link:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: var(--border-radius);
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }

        .btn-outline-primary {
            border-color: var(--primary-color);
            color: var(--primary-color);
            border-radius: var(--border-radius);
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }

        /* Loading States */
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--secondary-color);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: #dee2e6;
        }

        /* Quick Actions */
        .quick-actions {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .quick-actions h5 {
            margin-bottom: 1rem;
            color: var(--dark-color);
            font-weight: 600;
        }

        /* Compact Mode Styles */
        .compact-mode .setting-item {
            padding: 0.75rem 1rem;
        }

        .compact-mode .setting-key {
            font-size: 0.9rem;
        }

        .compact-mode .setting-description {
            font-size: 0.8rem;
        }

        .compact-mode .setting-display-value {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
        }

        /* Help Modal Styles */
        .modal-lg {
            max-width: 900px;
        }

        .help-category {
            border-left: 4px solid var(--primary-color);
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .help-category h6 {
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }

            .page-header {
                padding: 1.5rem;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .setting-value {
                width: 100%;
                justify-content: space-between;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div th:fragment="content">
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1><i class="fas fa-cogs me-3"></i>Paramètres Système</h1>
                    <p>Gérez la configuration de votre application GESCOM</p>
                </div>
                <div class="d-flex gap-3">
                    <button class="btn btn-light" onclick="refreshCache()">
                        <i class="fas fa-sync-alt me-2"></i>Rafraîchir Cache
                    </button>
                    <a th:href="@{/admin/settings/new}" class="btn btn-light">
                        <i class="fas fa-plus me-2"></i>Nouveau Paramètre
                    </a>
                </div>
            </div>
        </div>

        <!-- Flash Messages -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <div th:if="${warning}" class="alert alert-warning alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span th:text="${warning}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Statistics Cards -->
        <div class="row mb-4" th:if="${stats}">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stats-card">
                    <div class="icon text-primary">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <p class="number text-primary" th:text="${stats.totalSettings ?: 0}">0</p>
                    <p class="label">Total Paramètres</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stats-card">
                    <div class="icon text-info">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <p class="number text-info" th:text="${stats.systemSettings ?: 0}">0</p>
                    <p class="label">Paramètres Système</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stats-card">
                    <div class="icon text-success">
                        <i class="fas fa-user-cog"></i>
                    </div>
                    <p class="number text-success" th:text="${stats.userSettings ?: 0}">0</p>
                    <p class="label">Paramètres Utilisateur</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stats-card">
                    <div class="icon text-warning">
                        <i class="fas fa-clock"></i>
                    </div>
                    <p class="number text-warning" th:text="${stats.recentlyModifiedCount ?: 0}">0</p>
                    <p class="label">Modifiés (7j)</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h5><i class="fas fa-bolt me-2"></i>Actions Rapides</h5>
            <div class="d-flex flex-wrap gap-2">
                <button class="btn btn-outline-primary btn-sm" onclick="initializeDefaults()">
                    <i class="fas fa-database me-2"></i>Initialiser Défauts
                </button>
                <button class="btn btn-outline-success btn-sm" onclick="validateSettings()">
                    <i class="fas fa-check-double me-2"></i>Valider Paramètres
                </button>
                <a th:href="@{/admin/settings/export}" class="btn btn-outline-info btn-sm">
                    <i class="fas fa-download me-2"></i>Exporter
                </a>
                <button class="btn btn-outline-warning btn-sm" onclick="refreshCache()">
                    <i class="fas fa-sync-alt me-2"></i>Rafraîchir Cache
                </button>
                <button class="btn btn-outline-secondary btn-sm" onclick="toggleCompactMode()">
                    <i class="fas fa-compress-alt me-2"></i>Mode Compact
                </button>
                <button class="btn btn-outline-dark btn-sm" onclick="showSettingsHelp()">
                    <i class="fas fa-question-circle me-2"></i>Aide
                </button>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="search-filters">
            <form th:action="@{/admin/settings}" method="get" class="d-flex gap-3 align-items-end">
                <div class="flex-fill">
                    <label for="search" class="form-label">Rechercher</label>
                    <input type="text" class="form-control" id="search" name="search" 
                           th:value="${searchQuery}" placeholder="Clé, description...">
                </div>
                <div class="col-auto">
                    <label for="category" class="form-label">Catégorie</label>
                    <select class="form-select" id="category" name="category">
                        <option value="">Toutes les catégories</option>
                        <option th:each="cat : ${categories}" 
                                th:value="${cat}" 
                                th:text="${cat.displayName}"
                                th:selected="${selectedCategory == cat}">
                        </option>
                    </select>
                </div>
                <div class="col-auto">
                    <label for="isSystem" class="form-label">Type</label>
                    <select class="form-select" id="isSystem" name="isSystem">
                        <option value="">Tous</option>
                        <option value="true" th:selected="${isSystemFilter == true}">Système</option>
                        <option value="false" th:selected="${isSystemFilter == false}">Utilisateur</option>
                    </select>
                </div>
                <div class="col-auto">
                    <label for="view" class="form-label">Affichage</label>
                    <select class="form-select" id="view" name="view">
                        <option value="grouped" th:selected="${currentView == 'grouped'}">Groupé</option>
                        <option value="list" th:selected="${currentView == 'list'}">Liste</option>
                    </select>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search me-2"></i>Rechercher
                    </button>
                </div>
            </form>
        </div>

        <!-- Settings Content -->
        <div th:if="${currentView == 'grouped'}">
            <!-- Grouped View -->
            <div th:each="category : ${groupedSettings}" class="settings-section">
                <div class="settings-section-header">
                    <h4>
                        <i th:class="${category.key.icon}"></i>
                        <span th:text="${category.key.displayName}"></span>
                        <small class="text-muted">(<span th:text="${category.value.size()}"></span>)</small>
                    </h4>
                </div>
                <div class="settings-section-body">
                    <div th:each="setting : ${category.value}" class="setting-item">
                        <div class="setting-info">
                            <div class="setting-key">
                                <span th:text="${setting.key}"></span>
                                <span th:if="${setting.isSystem}" class="system-badge">Système</span>
                            </div>
                            <p class="setting-description" th:text="${setting.description}"></p>
                        </div>
                        <div class="setting-value">
                            <div class="setting-display-value" th:text="${setting.displayValue}"></div>
                            <div class="setting-actions">
                                <button class="btn-setting btn-edit" th:onclick="'editSetting(' + ${setting.id} + ')'">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-setting btn-duplicate" th:onclick="'duplicateSetting(' + ${setting.id} + ')'">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button th:if="!${setting.isSystem}" class="btn-setting btn-delete" 
                                        th:onclick="'deleteSetting(' + ${setting.id} + ', \'' + ${setting.key} + '\')'">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${currentView == 'list'}">
            <!-- List View -->
            <div class="settings-section">
                <div class="settings-section-body">
                    <div th:each="setting : ${settings}" class="setting-item">
                        <div class="setting-info">
                            <div class="setting-key">
                                <i th:class="${setting.category.icon} + ' me-2'"></i>
                                <span th:text="${setting.key}"></span>
                                <span th:if="${setting.isSystem}" class="system-badge">Système</span>
                            </div>
                            <p class="setting-description" th:text="${setting.description}"></p>
                        </div>
                        <div class="setting-value">
                            <div class="setting-display-value" th:text="${setting.displayValue}"></div>
                            <div class="setting-actions">
                                <button class="btn-setting btn-edit" th:onclick="'editSetting(' + ${setting.id} + ')'">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-setting btn-duplicate" th:onclick="'duplicateSetting(' + ${setting.id} + ')'">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button th:if="!${setting.isSystem}" class="btn-setting btn-delete" 
                                        th:onclick="'deleteSetting(' + ${setting.id} + ', \'' + ${setting.key} + '\')'">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div th:if="${(currentView == 'grouped' and groupedSettings.isEmpty()) or (currentView == 'list' and settings.isEmpty())}" 
             class="empty-state">
            <i class="fas fa-cogs"></i>
            <h4>Aucun paramètre trouvé</h4>
            <p>Créez votre premier paramètre ou modifiez vos critères de recherche</p>
            <a th:href="@{/admin/settings/new}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Créer un paramètre
            </a>
        </div>

        <!-- Pagination -->
        <nav th:if="${settingsPage != null and settingsPage.totalPages > 1}" aria-label="Navigation des paramètres">
            <ul class="pagination">
                <li class="page-item" th:classappend="${!settingsPage.hasPrevious()} ? 'disabled'">
                    <a class="page-link" th:href="@{/admin/settings(page=${currentPage - 1}, search=${searchQuery}, category=${selectedCategory}, isSystem=${isSystemFilter}, view=${currentView})}">
                        <i class="fas fa-chevron-left"></i> Précédent
                    </a>
                </li>
                
                <li th:each="page : ${#numbers.sequence(0, settingsPage.totalPages - 1)}" 
                    class="page-item" th:classappend="${page == currentPage} ? 'active'">
                    <a class="page-link" th:href="@{/admin/settings(page=${page}, search=${searchQuery}, category=${selectedCategory}, isSystem=${isSystemFilter}, view=${currentView})}" 
                       th:text="${page + 1}"></a>
                </li>
                
                <li class="page-item" th:classappend="${!settingsPage.hasNext()} ? 'disabled'">
                    <a class="page-link" th:href="@{/admin/settings(page=${currentPage + 1}, search=${searchQuery}, category=${selectedCategory}, isSystem=${isSystemFilter}, view=${currentView})}">
                        Suivant <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Help Modal -->
        <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="helpModalLabel">
                            <i class="fas fa-question-circle me-2"></i>
                            Aide - Gestion des Paramètres
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="help-category">
                            <h6><i class="fas fa-cog me-2"></i>Types de Paramètres</h6>
                            <ul>
                                <li><strong>Paramètres Système :</strong> Protégés contre la suppression, seule la valeur peut être modifiée</li>
                                <li><strong>Paramètres Utilisateur :</strong> Entièrement modifiables et supprimables</li>
                                <li><strong>Paramètres Cryptés :</strong> Les mots de passe sont automatiquement cryptés</li>
                            </ul>
                        </div>

                        <div class="help-category">
                            <h6><i class="fas fa-list me-2"></i>Catégories Disponibles</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-cog text-muted me-2"></i>Général - Paramètres de base</li>
                                        <li><i class="fas fa-building text-muted me-2"></i>Entreprise - Informations société</li>
                                        <li><i class="fas fa-envelope text-muted me-2"></i>Email - Configuration SMTP</li>
                                        <li><i class="fas fa-file-invoice text-muted me-2"></i>Facturation - Paramètres factures</li>
                                        <li><i class="fas fa-percent text-muted me-2"></i>Fiscalité - Gestion TVA</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-shield-alt text-muted me-2"></i>Sécurité - Paramètres sécurisés</li>
                                        <li><i class="fas fa-bell text-muted me-2"></i>Notifications - Alertes système</li>
                                        <li><i class="fas fa-server text-muted me-2"></i>Système - Configuration avancée</li>
                                        <li><i class="fas fa-plug text-muted me-2"></i>Intégrations - Services tiers</li>
                                        <li><i class="fas fa-palette text-muted me-2"></i>Apparence - Interface utilisateur</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="help-category">
                            <h6><i class="fas fa-edit me-2"></i>Types de Valeurs Supportés</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><strong>Texte :</strong> Chaîne simple</li>
                                        <li><strong>Texte Long :</strong> Multi-lignes</li>
                                        <li><strong>Nombre Entier :</strong> 42, -10</li>
                                        <li><strong>Nombre Décimal :</strong> 3.14, 19.6</li>
                                        <li><strong>Booléen :</strong> Vrai/Faux</li>
                                        <li><strong>Email :</strong> Adresse valide</li>
                                        <li><strong>URL :</strong> Adresse web</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><strong>Mot de Passe :</strong> Crypté automatiquement</li>
                                        <li><strong>Couleur :</strong> Code hexadécimal</li>
                                        <li><strong>Date :</strong> Format YYYY-MM-DD</li>
                                        <li><strong>Heure :</strong> Format HH:MM</li>
                                        <li><strong>JSON :</strong> Objet structuré</li>
                                        <li><strong>Chemin :</strong> Fichier/dossier</li>
                                        <li><strong>Liste :</strong> Valeurs séparées</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="help-category">
                            <h6><i class="fas fa-bolt me-2"></i>Actions Rapides</h6>
                            <ul>
                                <li><strong>Initialiser Défauts :</strong> Crée les paramètres système de base</li>
                                <li><strong>Valider Paramètres :</strong> Vérifie la cohérence des valeurs</li>
                                <li><strong>Exporter :</strong> Télécharge tous les paramètres en JSON</li>
                                <li><strong>Rafraîchir Cache :</strong> Recharge le cache des paramètres</li>
                                <li><strong>Mode Compact :</strong> Affichage condensé pour plus de paramètres</li>
                            </ul>
                        </div>

                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Conseil :</strong> Utilisez des clés structurées comme <code>categorie.nom</code> pour organiser vos paramètres (ex: <code>company.name</code>, <code>email.smtp_host</code>).
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                        <a th:href="@{/admin/help/settings}" class="btn btn-primary">
                            <i class="fas fa-book me-2"></i>Documentation Complète
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div th:fragment="js_assets">
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        // Vérifie si jQuery est disponible, sinon utilise du JavaScript vanilla
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Select2 si disponible
            if (typeof $ !== 'undefined' && $.fn.select2) {
                $('.form-select').select2({
                    theme: 'bootstrap-5',
                    width: '100%'
                });
            }
            
            // Validation des fonctionnalités
            validatePageFunctionality();
        });
        
        function validatePageFunctionality() {
            console.log('✅ Page de paramètres chargée');
            
            // Vérifier que les boutons sont fonctionnels
            const buttons = {
                'refreshCache': document.querySelector('button[onclick="refreshCache()"]'),
                'initializeDefaults': document.querySelector('button[onclick="initializeDefaults()"]'),
                'validateSettings': document.querySelector('button[onclick="validateSettings()"]'),
                'toggleCompactMode': document.querySelector('button[onclick="toggleCompactMode()"]'),
                'showSettingsHelp': document.querySelector('button[onclick="showSettingsHelp()"]')
            };
            
            Object.entries(buttons).forEach(([name, button]) => {
                if (button) {
                    console.log(`✅ Bouton ${name} trouvé et fonctionnel`);
                } else {
                    console.warn(`⚠️ Bouton ${name} non trouvé`);
                }
            });
            
            // Vérifier que les liens sont corrects
            const links = document.querySelectorAll('a[href*="/admin/settings"]');
            console.log(`✅ ${links.length} liens vers /admin/settings trouvés`);
            
            // Vérifier que les formulaires ont les CSRF tokens
            const csrfMeta = document.querySelector('meta[name="_csrf"]');
            if (csrfMeta) {
                console.log('✅ CSRF token configuré');
            } else {
                console.warn('⚠️ CSRF token manquant');
            }
        }

        function editSetting(id) {
            window.location.href = /*[[@{/admin/settings/edit/}]]*/ '/admin/settings/edit/' + id;
        }

        function duplicateSetting(id) {
            window.location.href = /*[[@{/admin/settings/duplicate/}]]*/ '/admin/settings/duplicate/' + id;
        }

        function deleteSetting(id, key) {
            if (confirm('Êtes-vous sûr de vouloir supprimer le paramètre "' + key + '" ?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = /*[[@{/admin/settings/delete/}]]*/ '/admin/settings/delete/' + id;
                
                const csrfToken = document.querySelector('meta[name="_csrf"]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = '_csrf';
                    csrfInput.value = csrfToken.getAttribute('content');
                    form.appendChild(csrfInput);
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        function refreshCache() {
            if (confirm('Rafraîchir le cache des paramètres ?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = /*[[@{/admin/settings/refresh-cache}]]*/ '/admin/settings/refresh-cache';
                
                const csrfToken = document.querySelector('meta[name="_csrf"]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = '_csrf';
                    csrfInput.value = csrfToken.getAttribute('content');
                    form.appendChild(csrfInput);
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        function initializeDefaults() {
            if (confirm('Initialiser les paramètres par défaut ? Cela ne modifiera pas les paramètres existants.')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = /*[[@{/admin/settings/initialize}]]*/ '/admin/settings/initialize';
                
                const csrfToken = document.querySelector('meta[name="_csrf"]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = '_csrf';
                    csrfInput.value = csrfToken.getAttribute('content');
                    form.appendChild(csrfInput);
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        function validateSettings() {
            if (confirm('Valider tous les paramètres ?')) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = /*[[@{/admin/settings/validate}]]*/ '/admin/settings/validate';
                
                const csrfToken = document.querySelector('meta[name="_csrf"]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = '_csrf';
                    csrfInput.value = csrfToken.getAttribute('content');
                    form.appendChild(csrfInput);
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        }

        function toggleCompactMode() {
            const body = document.body;
            const button = event.target.closest('button');
            
            if (body.classList.contains('compact-mode')) {
                body.classList.remove('compact-mode');
                button.innerHTML = '<i class="fas fa-compress-alt me-2"></i>Mode Compact';
                localStorage.setItem('settings-compact-mode', 'false');
            } else {
                body.classList.add('compact-mode');
                button.innerHTML = '<i class="fas fa-expand-alt me-2"></i>Mode Normal';
                localStorage.setItem('settings-compact-mode', 'true');
            }
        }

        function showSettingsHelp() {
            const helpModal = new bootstrap.Modal(document.getElementById('helpModal'));
            helpModal.show();
        }

        // Restore compact mode preference
        document.addEventListener('DOMContentLoaded', function() {
            if (localStorage.getItem('settings-compact-mode') === 'true') {
                document.body.classList.add('compact-mode');
                const button = document.querySelector('button[onclick="toggleCompactMode()"]');
                if (button) {
                    button.innerHTML = '<i class="fas fa-expand-alt me-2"></i>Mode Normal';
                }
            }
        });
    </script>
</div>
</body>
</html>